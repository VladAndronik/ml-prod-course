name: week-5-ci

on:
  push:
    branches:
      - 'week-5-hw-1'
      - 'main'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Build fastapi
        run: docker build -f ./week-5/Dockerfile -t app_fastapi:latest --target app-fastapi ./week-5/

      - name: Test fastapi
        run: docker run -e WANDB_API_KEY=${{ secrets.WANDB_API_KEY }} app_fastapi:latest pytest -ss ./tests/
